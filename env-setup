mkdir .status

# Get repository for Java installer
apt-add-repository -y ppa:webupd8team/java

# Mono repository keys
apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
echo "deb http://download.mono-project.com/repo/debian wheezy main" | tee /etc/apt/sources.list.d/mono-xamarin.list

# CoreCLR required additional repositories
echo "deb http://llvm.org/apt/trusty/ llvm-toolchain-trusty-3.6 main" | tee /etc/apt/sources.list.d/llvm.list
wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | apt-key add -

# All apt-get requirements
apt-get update
apt-get -y install oracle-java8-set-default oracle-java8-installer
apt-get -y install \
	nodejs npm git p7zip-full gcc nodejs-legacy \
	ghc cabal-install \
	open-cobol \
	libgmp3-dev libmpfr-dev mpc libmpc-dev g++-multilib \
	python3 python-pip \
	maven \
	cmake \
	llvm-3.5 clang-3.5 lldb-3.6 lldb-3.6-dev libunwind8 \
    libunwind8-dev gettext libicu-dev liblttng-ust-dev libcurl4-openssl-dev uuid-dev \
	mono-devel

if [ ! -f ".status/npm"]; then
	# Install google-closure-compiler
	npm install --save google-closure-compiler

	# Install Typescript compiler
	npm install -g typescript

	# Install CoffeeScript compiler
	npm install -g coffee-script

	echo "" > .status/npm
fi

if [! -f ".status/pyjs"]; then
	# Install python and PyJS
	pip install git+https://github.com/pyjs/pyjs.git#egg=pyjs
fi

# Install GnuCOBOL
ldconfig /usr/local/lib

./setup/install-jsil
./setup/install-emscripten

if [! -f ".status/dragome"]; then
	# Install Dragome
	git clone https://github.com/dragome/dragome-sdk
	cd dragome-sdk
	mvn package
	cd ../
fi

./setup/install-dragonegg
./setup/install-ghcjs

